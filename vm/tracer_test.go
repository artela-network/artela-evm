package vm

import (
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/math"
	"github.com/ethereum/go-ethereum/core/rawdb"
	"github.com/ethereum/go-ethereum/core/state"
	"github.com/ethereum/go-ethereum/params"
	"math/big"
	"testing"
)

type MockMessage struct {
}

func (m MockMessage) From() common.Address {
	return common.Address{}
}

func (m MockMessage) To() *common.Address {
	return &common.Address{}
}

func (m MockMessage) GasPrice() *big.Int {
	return big0
}

func (m MockMessage) GasFeeCap() *big.Int {
	return big0
}

func (m MockMessage) GasTipCap() *big.Int {
	return big0
}

func (m MockMessage) Gas() uint64 {
	return 0
}

func (m MockMessage) Value() *big.Int {
	return big0
}

func (m MockMessage) Nonce() uint64 {
	return 0
}

func (m MockMessage) IsFake() bool {
	return true
}

func (m MockMessage) Data() []byte {
	return nil
}

func TestNewCommands(t *testing.T) {
	byteCode := "60806040523462000023576200001462000029565b6142f66200003482396142f690f35b6200002f565b60405190565b5f80fdfe60806040526004361015610013575b61014f565b61001d5f3561003c565b806389ea642f146100375763f8a8fd6d0361000e5761011c565b6100e2565b60e01c90565b60405190565b5f80fd5b5f80fd5b5f91031261005a57565b61004c565b5190565b60209181520190565b5f5b83811061007e575050905f910152565b80602091830151818501520161006e565b601f801991011690565b6100b86100c16020936100c6936100af8161005f565b93848093610063565b9586910161006c565b61008f565b0190565b6100df9160208201915f818403910152610099565b90565b34610112576100f2366004610050565b61010e6100fd614107565b610105610042565b918291826100ca565b0390f35b610048565b5f0190565b3461014a5761012c366004610050565b6101346134e5565b61013c610042565b8061014681610117565b0390f35b610048565b5f80fd5be1565b634e487b7160e01b5f52604160045260245ffd5b906101749061008f565b810190811067ffffffffffffffff82111761018e57604052565b610156565b906101a661019f610042565b928361016a565b565b67ffffffffffffffff81116101c6576101c260209161008f565b0190565b610156565b906101dd6101d8836101a8565b610193565b918252565b5f7f4161612e62000000000000000000000000000000000000000000000000000000910152565b61021360056101cb565b90610220602083016101e2565b565b61022a610209565b90565b5f1c90565b90565b6102416102469161022d565b610232565b90565b6102539054610235565b90565b634e487b7160e01b5f52601160045260245ffd5b90565b6102769061026a565b5f1981146102845760010190565b610256565b5f1b90565b9061029a5f1991610289565b9181191691161790565b90565b6102bb6102b66102c09261026a565b6102a4565b61026a565b90565b90565b5f60209161030b6103046102fa7fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a320966102a7565b86868686e66102c3565b825461028e565b8155e6565be0565b5f7f4161612e64756d6d790000000000000000000000000000000000000000000000910152565b61034460096101cb565b9061035160208301610313565b565b61035b61033a565b90565b90565b61037561037061037a9261035e565b6102a4565b61026a565b90565b90610387906102a7565b5f5260205260405f2090565b7f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a10792916103df7fcd6dcca3071d7a6ffbb9feadb52e9faadc8fc60456fe88ed28777673b93cd053946102a7565b91e5565b634e487b7160e01b5f525f60045260245ffd5b634e487b7160e01b5f52602260045260245ffd5b906001600283049216801561042a575b602083101461042557565b6103f6565b91607f169161041a565b5f5260205f2090565b601f602091010490565b1b90565b919060086104669102916104605f1984610447565b92610447565b9181191691161790565b5f906104b76020936104af6104a57fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a320976102a7565b87878787e66102c3565b90835461044b565b8155e6565b5f90565b6104d2916104cc6104bc565b91610470565b565b5b8181106104e0575050565b806104ed5f6001936104c0565b016104d5565b9190601f8111610503575b505050565b61050f61053493610434565b90602061051b8461043d565b8301931061053c575b61052d9061043d565b01906104d4565b5f80806104fe565b915061052d81929050610524565b61055f6004610559835461040a565b836104f3565b60087f6861686100000000000000000000000000000000000000000000000000000000019055565b7f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a10792908181e76105b58161054a565be7565b90565b6105cf6105ca6105d4926105b8565b6102a4565b61026a565b90565b5f7f4161612e64756d6d793200000000000000000000000000000000000000000000910152565b610608600a6101cb565b90610615602083016105d7565b565b61061f6105fe565b90565b905090565b61064c6106439260209261063a8161005f565b94858093610622565b9384910161006c565b0190565b90565b61065f6106649161026a565b610650565b9052565b61067861067f9160209493610627565b8092610653565b0190565b61069761068e610042565b92839283610668565b03902090565b6106a691610683565b90565b90565b5f907fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a320926106fa7feaa5d70ac8cfbfe2134bec12654dfc7c8dab9186ea31e9425f7ad6aedc30c972956106a9565b91e2565b90565b61071561071061071a926106fe565b6102a4565b61026a565b90565b5f7f4161612e6d795374727563740000000000000000000000000000000000000000910152565b61074e600c6101cb565b9061075b6020830161071d565b565b610765610744565b90565be2565b5f7f6100000000000000000000000000000000000000000000000000000000000000910152565b61079c60016101cb565b906107a96020830161076b565b565b6107b3610792565b90565be3565b5f7f6200000000000000000000000000000000000000000000000000000000000000910152565b6107ea60016101cb565b906107f7602083016107b9565b565b6108016107e0565b90565b5f5260205f2090565b905f92918054906108276108208361040a565b8094610622565b916001811690815f146108795750600114610842575b505050565b61084f9192939450610804565b5f905b83821061086557505001905f808061083d565b600181602092548486015201910190610852565b92949550505060ff191682528015150201905f808061083d565b7f616e6f74686572000000000000000000000000000000000000000000000000009052565b6108c49060079261080d565b6108cd81610893565b0190565b906108f96108dd610042565b80936108ed6020830191826108b8565b9081038252038361016a565b565b5f7f4161612e73747200000000000000000000000000000000000000000000000000910152565b61092c60076101cb565b90610939602083016108fb565b565b610943610922565b90565b9190601f8111610956575b505050565b61096261098793610804565b90602061096e8461043d565b8301931061098f575b6109809061043d565b01906104d4565b5f8080610951565b915061098081929050610977565b1c90565b906109b1905f199060080261099d565b191690565b816109c0916109a1565b906002021790565b906109d28161005f565b9067ffffffffffffffff8211610a92576109f6826109f0855461040a565b85610946565b602090601f8311600114610a2a57918091610a19935f92610a1e575b50506109b6565b90555b565b90915001515f80610a12565b601f19831691610a3985610804565b925f5b818110610a7a57509160029391856001969410610a60575b50505002019055610a1c565b610a70910151601f8416906109a1565b90555f8080610a54565b91936020600181928787015181550195019201610a3c565b610156565b610ac57f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a10792928383e7826109c8565be7565b60ff1690565b610ae2610add610ae7926106fe565b6102a4565b610ac8565b90565b5f7f4161612e62310000000000000000000000000000000000000000000000000000910152565b610b1b60066101cb565b90610b2860208301610aea565b565b610b32610b11565b90565b60081c90565b60ff1690565b610b4d610b5291610b35565b610b3b565b90565b610b5f9054610b41565b90565b610b8190610b7b610b75610b8694610ac8565b91610ac8565b90610447565b610ac8565b90565b60081b90565b90610b9c61ff0091610b89565b9181191691161790565b610bba610bb5610bbf92610ac8565b6102a4565b610ac8565b90565b90565b60018091610c0a610c03610bf97f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576896610ba6565b86858086e6610bc2565b8254610b8f565b8155e6565b90565b610c26610c21610c2b92610c0f565b6102a4565b610ac8565b90565b5f7f4161612e63310000000000000000000000000000000000000000000000000000910152565b610c5f60066101cb565b90610c6c60208301610c2e565b565b610c76610c55565b90565b60101b90565b90610c8d62ff000091610c79565b9181191691161790565b6002600191610cdd610cd6610ccc7f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576896610ba6565b86868686e6610bc2565b8254610c7f565b8155e6565b67ffffffffffffffff8111610cf75760200290565b610156565b610d08610d0d91610ce2565b610193565b90565b610d1a6020610193565b90565b90565b610d34610d2f610d3992610d1d565b6102a4565b610ac8565b90565b90610d4690610ac8565b9052565b52565b5f7f4161612e74696e79537472756374734669786564000000000000000000000000910152565b610d7e60146101cb565b90610d8b60208301610d4d565b565b610d95610d74565b90565b90565b50600190565b610db0610db69193929361026a565b9261026a565b91610dc283820261026a565b928184041490151715610dd157565b610256565b600190818003010490565b90565b60015f7f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576892610e407f314aff556ea0dbc2fba2f054980f11b71f1371f31235be0bb5afc8b6c32f770a8584610e376107ab565b81860186610768565b83838383e68180820155e6565b905f03610e5f57610e5d90610de4565b565b6103e3565b5b818110610e70575050565b80610e7d5f600193610e4d565b01610e65565b90610e96905f199060200360080261099d565b8154169055565be5565b90808310610eae575b505050565b610eb781610dd6565b91610ec184610dd6565b610eca82610de1565b908101938101945b838110610eef575050505090610ee791610e64565b5f8080610ea9565b80610f417fe00299c0834104f0c61c7ef58becf9d0493dc4bbe0046035a185a1dd1d14c1e37f314aff556ea0dbc2fba2f054980f11b71f1371f31235be0bb5afc8b6c32f770a83600195870188610e9d565b01610ed2565b90680100000000000000008111610f6d5781610f65610f6b93610d9b565b90610ea0565b565b610156565b50600190565b5190565b610f869051610ac8565b90565b90610f9560ff91610289565b9181191691161790565b5f600191610fe4610fdd610fd37f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576896610ba6565b86868686e6610bc2565b8254610f89565b8155e6565b611056916110517f314aff556ea0dbc2fba2f054980f11b71f1371f31235be0bb5afc8b6c32f770a7f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c57685f611041818088019601610f7c565b958561104b6107ab565b91610768565b610f9f565b565b9061106291610fe9565b565b61108061107083610f72565b9261107b8484610f47565b610d98565b9061108a81610de1565b905f925b84841061109c575050505050565b60016020826111016110ae8495610f78565b6110fb7fe00299c0834104f0c61c7ef58becf9d0493dc4bbe0046035a185a1dd1d14c1e37f314aff556ea0dbc2fba2f054980f11b71f1371f31235be0bb5afc8b6c32f770a8b8b8b610e9d565b87611058565b0193019301929161108e565b9061111791611064565b565b5f7f4161612e74696e79537472756374730000000000000000000000000000000000910152565b61114a600f6101cb565b9061115760208301611119565b565b611161611140565b90565b90565b5f5260205f2090565b634e487b7160e01b5f52603260045260245ffd5b5490565b61119181611184565b8210156111ab576111a3600191611167565b910201905f90565b611170565b91906111c1576111bf91610fe9565b565b6103e3565b90815468010000000000000000811015611243576112419260018201815561123c7f2e52b07f566a53e277658280b9345cd16f3ccfeb9c8d92cd38ea48638fa405c77f314aff556ea0dbc2fba2f054980f11b71f1371f31235be0bb5afc8b6c32f770a6112338585611188565b95908095610e9d565b6111b0565b565b610156565b634e487b7160e01b5f52603160045260245ffd5b61126581611184565b80156112d35760019003906112d061127d8383611188565b906112cb7f2e52b07f566a53e277658280b9345cd16f3ccfeb9c8d92cd38ea48638fa405c77f314aff556ea0dbc2fba2f054980f11b71f1371f31235be0bb5afc8b6c32f770a878488610e9d565b610e4d565b55565b611248565b5f7f4161612e6d795374727563744172720000000000000000000000000000000000910152565b611309600f6101cb565b90611316602083016112d8565b565b6113206112ff565b90565b90565b6113306040610193565b90565b9061133d9061026a565b9052565b5f7f7869786900000000000000000000000000000000000000000000000000000000910152565b61137260046101cb565b9061137f60208301611341565b565b611389611368565b90565b52565b5f5260205f2090565b5490565b6113a581611398565b8210156113bf576113b760029161138f565b910201905f90565b611170565b6113ce905161026a565b90565b5190565b6114af916114455f83016113ea5f84016113c4565b906114407f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd7fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a3205f6114396107ab565b858a610768565b6102c6565b6114aa7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd7f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a1079261149a60206001870195016113d1565b94846114a46107f9565b916107b6565b610a97565b565b91906114c2576114c0916113d5565b565b6103e3565b90815468010000000000000000811015611544576115429260018201815561153d7fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3787f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd611534858561139c565b95908095610e9d565b6114b1565b565b610156565b5490565b5f5260205f2090565b61155f81611549565b8210156115795761157160029161154d565b910201905f90565b611170565b67ffffffffffffffff81116115935760200290565b610156565b6115a46115a99161157e565b610193565b90565b6115c06115bb6115c592610c0f565b6102a4565b61026a565b90565b5f7f6875687500000000000000000000000000000000000000000000000000000000910152565b6115f960046101cb565b90611606602083016115c8565b565b6116106115ef565b90565b52565b90565b61162d61162861163292611616565b6102a4565b61026a565b90565b5f7f6861686100000000000000000000000000000000000000000000000000000000910152565b61166660046101cb565b9061167360208301611635565b565b61167d61165c565b90565b90565b61168e906002610da1565b90565b5b81811061169d575050565b806116aa5f6001936104c0565b01611692565b905f916116c76116bf82610804565b9283546109b6565b905555565b919290602082105f1461172557601f84116001146116f5576116ef9293506109b6565b90555b5b565b509061171b61172093600161171261170c85610804565b9261043d565b820191016104d4565b6116b0565b6116f2565b5061175c8293611736600194610804565b6117556117428561043d565b820192601f861680611767575b5061043d565b01906104d4565b6002021790556116f3565b61177390888603610e83565b5f61174f565b9290916801000000000000000082116117d9576020115f146117ca57602081105f146117ae576117a8916109b6565b90555b5b565b60019160ff19166117be84610804565b556002020190556117ab565b600191506002020190556117ac565b610156565b9081546117ea8161040a565b90818311611813575b818310611801575b50505050565b61180a936116cc565b5f8080806117fb565b61181f83838387611779565b6117f3565be4565b5f611831916117de565b565b905f0361186b57807f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a107928092e761186881611827565be7565b6103e3565b5f6001611936926118ce7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd7fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a320856118c56107ab565b81860186610768565b6118da838083016104c0565b6119307f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd7f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a107926119276107f9565b858501856107b6565b01611833565b565b905f0361194a5761194890611870565b565b6103e3565b5b81811061195b575050565b806119685f600293611938565b01611950565b9080831061197c575b505050565b61198581611683565b9161198f84611683565b6119988261154d565b908101938101945b8381106119bd5750505050906119b59161194f565b5f8080611977565b80611a127fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3787f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd83600195600202870188610e9d565b016119a0565b90680100000000000000008111611a415781611a36611a3f93611549565b9082815561196e565b565b610156565b50600290565b5190565b90611a5a916113d5565b565b611a78611a6883611a46565b92611a738484611a18565b611680565b90611a828161154d565b905f925b848410611a94575050505050565b6002602082611afa611aa7600195611a4c565b611af47fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3787f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd8b8b8b610e9d565b87611a50565b01930193019291611a86565b90611b1091611a5c565b565b90565b611b29611b24611b2e9261026a565b6102a4565b610ac8565b90565b5f7f4161612e61310000000000000000000000000000000000000000000000000000910152565b611b6260066101cb565b90611b6f60208301611b31565b565b611b79611b58565b90565b5f600191611bc1611bba611bb07f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576896610ace565b86868686e6610bc2565b8254610f89565b8155e6565b67ffffffffffffffff8111611bdb5760200290565b610156565b611bec611bf191611bc6565b610193565b90565b611c00611c059161022d565b610b3b565b90565b611c129054611bf4565b90565b60101c90565b611c27611c2c91611c15565b610b3b565b90565b611c399054611c1b565b90565b611c50611c4b611c5592610ac8565b6102a4565b61026a565b90565b90565b611c6f611c6a611c7492611c58565b6102a4565b61026a565b90565b611c8160c0610193565b90565b61ffff1690565b611c9f611c9a611ca492610ac8565b6102a4565b611c84565b90565b90611cb190611c84565b9052565b52565b52565b5f7f4161612e64756d6d793400000000000000000000000000000000000000000000910152565b611cec600a6101cb565b90611cf960208301611cbb565b565b611d03611ce2565b90565b611d1260048092610622565b611d1b81611635565b0190565b90611d35611d2e602093611d06565b8092610653565b0190565b611d4e90611d45610042565b91829182611d1f565b03902090565b611d5d90611d39565b90565b7f3c62d57109346e2a2aac231a4bb8b39ca196dafc42d338cfbb8dc75fa854bce3907f214ecaffacff196e9923fced61fed3404b15f0113ad53173303e14c2f58def1992611dac611675565b91e3565b90611dba906102a7565b5f5260205260405f2090565b7ff2784eaa930100526159eed39b014cb3ca271a9aded354823284bd8f76e416a891611e127f3c62d57109346e2a2aac231a4bb8b39ca196dafc42d338cfbb8dc75fa854bce3946102a7565b91e5565b90565b5490565b611e28906008610da1565b90565b5f5260205f2090565b5f7f6300000000000000000000000000000000000000000000000000000000000000910152565b611e6560016101cb565b90611e7260208301611e34565b565b611e7c611e5b565b90565b5f7f6400000000000000000000000000000000000000000000000000000000000000910152565b611eb060016101cb565b90611ebd60208301611e7f565b565b611ec7611ea6565b90565b5f7f6500000000000000000000000000000000000000000000000000000000000000910152565b611efb60016101cb565b90611f0860208301611eca565b565b611f12611ef1565b90565b5f7f6600000000000000000000000000000000000000000000000000000000000000910152565b611f4660016101cb565b90611f5360208301611f15565b565b611f5d611f3c565b90565b611f6b906002610da1565b90565b5f5b60028110611f915750611f8f90611f876002611f60565b81019061194f565b565b80611fe67f0be85c8ce5157bca9d63547db97c6cb360ead55f88d92e4a27fbd616214584ba7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd83600195600202870187610e9d565b01611f70565b905f03611ffe57611ffc90611f6e565b565b6103e3565b5f60046121d6926120617f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c5768856120586107ab565b81860186610768565b7f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576860018483e682808201557f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576860018483e66121097f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a107926120ff611ebf565b60018501856107b6565b6121168360018301611833565b61216d7f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd612163611f0a565b60028501856107b6565b61217a8360028301611938565b6121d07f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f0be85c8ce5157bca9d63547db97c6cb360ead55f88d92e4a27fbd616214584ba6121c7611f55565b858501856107b6565b01611fec565b565b905f036121ea576121e890612003565b565b6103e3565b5b8181106121fb575050565b806122085f6008936121d8565b016121f0565b9080831061221c575b505050565b61222581611e1d565b9161222f84611e1d565b61223882611e2b565b908101938101945b83811061225d575050505090612255916121ef565b5f8080612217565b806122b27ff2784eaa930100526159eed39b014cb3ca271a9aded354823284bd8f76e416a87f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f83600195600802870188610e9d565b01612240565b906801000000000000000081116122e157816122d66122df93611e19565b9082815561220e565b565b610156565b50600190565b5190565b6122fa9051611c84565b90565b9061230c63ffff000091610c79565b9181191691161790565b61232a61232561232f92611c84565b6102a4565b611c84565b90565b90565b6002809161237a6123736123697f267213ef861edf3fe34af6b9cfb0ad56eab938266c1eb202eb53960133fc235396612316565b86858086e6612332565b82546122fd565b8155e6565b5190565b50600290565b90565b9080831061239a575b505050565b6123a381611f60565b916123ad84611f60565b6123b682612389565b908101938101945b8381106123db5750505050906123d39161194f565b5f8080612395565b806124307f0be85c8ce5157bca9d63547db97c6cb360ead55f88d92e4a27fbd616214584ba7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd83600195600202870188610e9d565b016123be565b9068010000000000000000811161245c578161245461245a93612383565b9061238c565b565b610156565b61247d61246d83611a46565b926124788484612436565b611680565b9061248781612389565b905f925b848410612499575050505050565b60026020826124ff6124ac600195611a4c565b6124f97f0be85c8ce5157bca9d63547db97c6cb360ead55f88d92e4a27fbd616214584ba7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd8b8b8b610e9d565b87611a50565b0193019301929161248b565b9061251591612461565b565b6127a7916125875f830161252c5f8401610f7c565b906125827f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c57685f61257b6107ab565b858a610768565b610f9f565b6125f55f830161259960208401610f7c565b906125f07f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576860016125e96107f9565b858a610768565b610bc5565b6126635f8301612607604084016122f0565b9061265e7f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f267213ef861edf3fe34af6b9cfb0ad56eab938266c1eb202eb53960133fc23536002612657611e74565b858a610768565b612335565b6126d060018301612676606084016113d1565b906126cb7f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a107926126c4611ebf565b84896107b6565b610a97565b61273d600283016126e360808401611a4c565b906127387f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd612731611f0a565b84896107b6565b611a50565b6127a27f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f7f0be85c8ce5157bca9d63547db97c6cb360ead55f88d92e4a27fbd616214584ba61279260a060048701950161237f565b948461279c611f55565b916107b6565b61250b565b565b906127b391612517565b565b6127d16127c1836122e6565b926127cc84846122b8565b611e16565b906127db81611e2b565b905f925b8484106127ed575050505050565b60086020826128536128006001956122ec565b61284d7ff2784eaa930100526159eed39b014cb3ca271a9aded354823284bd8f76e416a87f24470bb8f17146dccab2cbdac081750ac63d2cf411fe623484f02e908f57b88f8b8b8b610e9d565b876127a9565b019301930192916127df565b90612869916127b5565b565b61287481611398565b80156128e25760019003906128df61288c838361139c565b906128da7fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3787f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd878488610e9d565b611938565b55565b611248565b5f6128f191611a18565b565b905f0361290557612903906128e7565b565b6103e3565b5f7f4161612e64756d6d793300000000000000000000000000000000000000000000910152565b61293b600a6101cb565b906129486020830161290a565b565b612952612931565b90565b61296561296c916020949361080d565b8092610653565b0190565b61298461297b610042565b92839283612955565b03902090565b61299391612970565b90565b60209181520190565b905f92918054906129b96129b28361040a565b8094612996565b916001811690815f14612a1057506001146129d4575b505050565b6129e19192939450610804565b915f925b8184106129f857505001905f80806129cf565b600181602092959395548486015201910192906129e5565b92949550505060ff19168252151560200201905f80806129cf565b90612a359161299f565b90565b90612a58612a5192612a48610042565b93848092612a2b565b038361016a565b565b612a6390612a38565b90565b7f6f890140a47537e235dcade50cbbf5cb100b697525521c57f6d6f20e7ef20e6291612ab27f49961f8c61966a34ce51f6e8a685eb7cecc36d8a047bf9bc156130750e443cab94612a5a565b91e3565b90565b612acd612ac8612ad292612ab6565b6102a4565b610ac8565b90565b90565b612aec612ae7612af192612ad5565b6102a4565b610ac8565b90565b90612afe90611c3c565b5f5260205260405f2090565b7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd91612b567f6f890140a47537e235dcade50cbbf5cb100b697525521c57f6d6f20e7ef20e6294611c3c565b91e5565b67ffffffffffffffff8111612b6f5760200290565b610156565b612b80612b8591612b5a565b610193565b90565b612b9c612b97612ba192611c58565b6102a4565b610ac8565b90565b5f7f4161612e75696e74384172720000000000000000000000000000000000000000910152565b612bd5600c6101cb565b90612be260208301612ba4565b565b612bec612bcb565b90565b50600290565b60209060018203010490565b90565b5b818110612c10575050565b80612c1d5f6001936104c0565b01612c05565b929190808210612c34575b50509050565b612c3d81612bf5565b90612c4783612bf5565b612c5086612c01565b90810192810193600160208206025f8111612ce0575b505b828110612c8557505050612c7d929350612c04565b805f80612c2e565b80612cda7fa04a30bf4bc4b4d8b6b83e9d32902ee9a6559235bb0c2379131b9152fe48f2397f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c57686001809502848088018d611824565b01612c68565b612ced9060018603610e83565b5f612c66565b90680100000000000000008111612d195781612d11612d1793612bef565b90612c23565b565b610156565b50600290565b90565b91906008612d42910291612d3c60ff84610447565b92610447565b9181191691161790565b612d5582612d1e565b9167ffffffffffffffff8311612f3a57612d7890612d738484612cf3565b612d24565b612d8182612c01565b9060208404935f5b858110612e7f5750602085029003935f8511612da7575b5050505050565b5f9201925f905b858210612dfa5750505081555f5b828110612dca578080612da0565b807f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576860018093810285e601612dbc565b9091926020612e20600192612e16612e1188610f7c565b610bc2565b9086850290612d27565b9401927f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576882828102612e767fa04a30bf4bc4b4d8b6b83e9d32902ee9a6559235bb0c2379131b9152fe48f2398483878d8b611824565b88e60190612dae565b835f6020830290875f915b60208310612e9f575050505050600101612d89565b6001809392612f217fa04a30bf4bc4b4d8b6b83e9d32902ee9a6559235bb0c2379131b9152fe48f2397f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c57688a6020612f0e8f9b9c9f98612f06612f01869b610f7c565b610bc2565b908990612d27565b9a019d01938588029085898d0191611824565b828280860283e685815581840290e60187879392612e8a565b610156565b90612f4991612d4c565b565b67ffffffffffffffff8111612f605760200290565b610156565b612f71612f7691612f4b565b610193565b90565b5f7f4161612e75696e74384172723200000000000000000000000000000000000000910152565b612faa600d6101cb565b90612fb760208301612f79565b565b612fc1612fa0565b90565b50600390565b60209060018203010490565b90565b929190808210612fea575b50509050565b612ff381612fca565b90612ffd83612fca565b61300686612fd6565b90810192810193600160208206025f8111613096575b505b82811061303b57505050613033929350612c04565b805f80612fe4565b806130907f7580157a2bfad4d9a8aa2fc8549fade33bf719254d824e88d6738cd409836ce17f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c57686001809502848088018d611824565b0161301e565b6130a39060018603610e83565b5f61301c565b906801000000000000000081116130cf57816130c76130cd93612fc4565b90612fd9565b565b610156565b50600390565b90565b6130e6826130d4565b9167ffffffffffffffff83116132cb576131099061310484846130a9565b6130da565b61311282612fd6565b9060208404935f5b8581106132105750602085029003935f8511613138575b5050505050565b5f9201925f905b85821061318b5750505081555f5b82811061315b578080613131565b807f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576860018093810285e60161314d565b90919260206131b16001926131a76131a288610f7c565b610bc2565b9086850290612d27565b9401927f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c5768828281026132077f7580157a2bfad4d9a8aa2fc8549fade33bf719254d824e88d6738cd409836ce18483878d8b611824565b88e6019061313f565b835f6020830290875f915b6020831061323057505050505060010161311a565b60018093926132b27f7580157a2bfad4d9a8aa2fc8549fade33bf719254d824e88d6738cd409836ce17f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c57688a602061329f8f9b9c9f98613297613292869b610f7c565b610bc2565b908990612d27565b9a019d01938588029085898d0191611824565b828280860283e685815581840290e6018787939261321b565b610156565b906132da916130dd565b565b5f7f4161612e75696e74323536417272000000000000000000000000000000000000910152565b61330d600e6101cb565b9061331a602083016132dc565b565b613324613303565b90565b50600290565b600190818003010490565b90565b90808310613349575b505050565b6133528161332d565b9161335c8461332d565b61336582613338565b908101938101945b83811061338a57505050509061338291611691565b5f8080613344565b806133dd7f81a16b98185c7bd2d0dce185b602e6fd5e7f09902ae8b4958778da8d8690789a7fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a3205f84600196880189611824565b0161336d565b90680100000000000000008111613409578161340161340793613327565b9061333b565b565b610156565b61341782612d1e565b9167ffffffffffffffff83116134d45761343a9061343584846133e3565b612d24565b600161344583613338565b9304925f5b848110613458575050505050565b6001907fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a32060205f878261349261348d8a610f7c565b6102c3565b9801976134c67f81a16b98185c7bd2d0dce185b602e6fd5e7f09902ae8b4958778da8d8690789a868589808d018097611824565b84848484e68155e60161344a565b610156565b906134e39161340e565b565b6135197fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a3205f6001613514610222565b610153565b61353561352e6135296001610249565b61026d565b60016102c6565b6135687fcd6dcca3071d7a6ffbb9feadb52e9faadc8fc60456fe88ed28777673b93cd0536002613563610353565b610310565b6135d060026135cb61357b6101f4610361565b6135af7fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a3205f60016135aa610222565b610153565b6135ba8160016102c6565b6135c4818461037d565b8093610393565b610587565b6136336135dd60646105bb565b6136107feaa5d70ac8cfbfe2134bec12654dfc7c8dab9186ea31e9425f7ad6aedc30c972600361360b610617565b610310565b600361362e61361d614107565b613627818461069d565b80936106ac565b6102c6565b6136d36136406001610701565b6136737f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd600e61366e61075d565b610310565b600e6136ce7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd7fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a3205f80850194856136c86107ab565b91610768565b6102c6565b6137067f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd600e61370161075d565b610310565b613769600e6137647f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd7f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a1079260018401938461375e6107f9565b916107b6565b610587565b6137b061377660066108d1565b6137a97f97fc46276c172633607a331542609db1e3da793fca183d594ed5a61803a1079260066137a461093b565b610310565b6006610a97565b6138086138026137c06001610ace565b6137f47f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576860015f6137ef610b2a565b610153565b6137fd5f610b55565b610b62565b5f610bc5565b61384f6138156003610c12565b6138497f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576860025f613844610c6e565b610153565b5f610c97565b6138bf61385c6001610cfc565b613885600561387d61387561386f610d10565b92610d20565b5f8301610d3c565b5f8301610d4a565b6138b87fe00299c0834104f0c61c7ef58becf9d0493dc4bbe0046035a185a1dd1d14c1e360096138b3610d8d565b610310565b600961110d565b6138f27f2e52b07f566a53e277658280b9345cd16f3ccfeb9c8d92cd38ea48638fa405c760086138ed611159565b610310565b6139236138ff6008611164565b60039061391e613916613910610d10565b93610c12565b5f8401610d3c565b6111c6565b6139567f2e52b07f566a53e277658280b9345cd16f3ccfeb9c8d92cd38ea48638fa405c76008613951611159565b610310565b6139686139636008611164565b61125c565b61399b7fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3786007613996611318565b610310565b6139e06139a86007611323565b6001906139c76139bf6139b9611326565b93610701565b5f8401611333565b6139db6139d2611381565b6020840161138c565b6114c7565b6139e8614160565b50613ae16139f660646105bb565b613a297fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3786007613a24611318565b610310565b6007613a837fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3787f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd5f613a7b8186611556565b508095610e9d565b613adc7f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd7fec13d6d12b88433319b64e1065a96ea19cd330ef6603f5f6fb685dde3959a3205f8085019485613ad66107ab565b91610768565b6102c6565b613ba3613aee6002611598565b613b2b6003613b0f613b07613b01611326565b926115ac565b5f8301611333565b613b23613b1a611608565b6020830161138c565b5f8301611613565b613b696004613b4c613b44613b3e611326565b92611619565b5f8301611333565b613b60613b57611675565b6020830161138c565b60208301611613565b613b9c7fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3786007613b97611318565b610310565b6007611b06565b613bd67f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd600e613bd161075d565b610310565b613e3e613beb613be6600e611b12565b6141f8565b613c776001613c71613c04613bff8561413c565b611b15565b613c377f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c57685f80613c32611b71565b610153565b613c6b7f7bcdc9c647aca74b3eb727f711c2c1c11ccd7ca9ebd6093c494ab4a9294c576860015f613c66610b2a565b610153565b5f610bc5565b5f611b7c565b613c808161413c565b50613c8b6001611be0565b90613dd2613c985f611c08565b613dca613ca45f610b55565b613dc1613cb05f611c2f565b613da4613d9b600192613cd5613ccd613cc7611326565b95610701565b5f8601611333565b613ce9613ce0611675565b6020860161138c565b613d96613cf66002611598565b96613d3b613d035f610b55565b613d1f613d17613d11611326565b92611c3c565b5f8301611333565b613d33613d2a611675565b6020830161138c565b5f8a01611613565b613d796002613d5c613d54613d4e611326565b92611c5b565b5f8301611333565b613d70613d67611675565b6020830161138c565b60208a01611613565b613d8d613d84611c77565b9a5f8c01610d3c565b60208a01610d3c565b611c8b565b60408701611ca7565b613db8613daf611675565b6060870161138c565b60808501611613565b60a08301611cb5565b5f8401611cb8565b613e057f214ecaffacff196e9923fced61fed3404b15f0113ad53173303e14c2f58def196005613e00611cfb565b610310565b613e39613e285f600593613e22613e1b86611d54565b8096611d60565b01610249565b613e328184611db0565b8093611dc6565b61285f565b613e717fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3786007613e6c611318565b610310565b613e83613e7e6007611323565b61286b565b613eb67fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3786007613eb1611318565b610310565b613ec15f60076128f3565b613f826001600290613ee5613edd613ed7611326565b93611c5b565b5f8401611333565b613ef9613ef0611675565b6020840161138c565b613f2c7f49961f8c61966a34ce51f6e8a685eb7cecc36d8a047bf9bc156130750e443cab6004613f2761294a565b610310565b600490613f58613f476002613f416001610249565b9061037d565b613f51818561298a565b8094612a66565b5f146140f057613f7d613f6b60ff612ad8565b5b613f768184612af4565b8093612b0a565b611a50565b613ff4613f8f6002612b74565b613fa4613f9c6001610ace565b5f8301610d3c565b613fba613fb16002612b88565b60208301610d3c565b613fed7fa04a30bf4bc4b4d8b6b83e9d32902ee9a6559235bb0c2379131b9152fe48f239600a613fe8612be4565b610310565b600a612f3f565b61407c6140016003612f65565b61401661400e6001610ace565b5f8301610d3c565b61402c6140236002612b88565b60208301610d3c565b6140426140396003610c12565b60408301610d3c565b6140757f7580157a2bfad4d9a8aa2fc8549fade33bf719254d824e88d6738cd409836ce1600b614070612fb9565b610310565b600b6132d0565b6140ee6140896002612b74565b61409e6140966001610ace565b5f8301610d3c565b6140b46140ab6002612b88565b60208301610d3c565b6140e77f81a16b98185c7bd2d0dce185b602e6fd5e7f09902ae8b4958778da8d8690789a600c6140e261331c565b610310565b600c6134d9565b565b613f7d6140fd60c7612ab9565b613f6c565b606090565b61410f614102565b5061412d61412860026141226001610249565b9061037d565b612a5a565b90565b61413991612970565b90565b61415861415d9161414b6104bc565b5060016003910190614130565b610249565b90565b6141937fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d378600761418e611318565b610310565b6141f560076141f07fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3787f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd5f6141e88186611556565b508095610e9d565b611b12565b90565b6142989061422f7fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d378600761422a611318565b610310565b6142937fc701674f6346df61626667de56ca895fed220fc6d6842251618824f6d0e0d3787f3aa1d5bb327655624d37fbd849f9fa3d316cdf125a7684c41725cf2041be9cbd6142815f60079501610249565b61428b8186611556565b508095610e9d565b611b12565b9056fea26469706673582212208557b4f7a52dfbcbb1c84dd84c4b2b0cf788b19dddbb889e449faa7cb798cfa864736f6c637827302e382e32312d63692e323032332e362e31342b636f6d6d69742e32366563303831362e6d6f640058"
	input := "f8a8fd6d"
	statedb, _ := state.New(common.Hash{}, state.NewDatabase(rawdb.NewMemoryDatabase()), nil)
	vmConf := Config{
		ExtraEips: []int{3855},
	}
	sender := common.Address{}
	sender.SetBytes([]byte("artela"))

	vmctx := BlockContext{
		Transfer: func(StateDB, common.Address, common.Address, *big.Int) {},
		CanTransfer: func(db StateDB, address common.Address, b *big.Int) bool {
			return true
		},
		BlockNumber: big0,
	}
	evm := NewEVM(vmctx, TxContext{Msg: new(MockMessage)}, statedb, params.AllEthashProtocolChanges, vmConf)
	_, address, _, err := evm.Create(AccountRef(sender), common.Hex2Bytes(byteCode), math.MaxUint64, new(big.Int))
	if err != nil {
		t.Error(err)
	}
	statedb.Finalise(true)

	evm = NewEVM(vmctx, TxContext{Msg: new(MockMessage)}, statedb, params.AllEthashProtocolChanges, vmConf)
	_, _, err = evm.Call(AccountRef(sender), address, common.Hex2Bytes(input), math.MaxUint64, new(big.Int))
	if err != nil {
		t.Error(err)
	}

	//stateChanges := evm.Tracer().StateChanges()
	//
	//stateChange1 := stateChanges.Variable(address, "MyToken.dummy3", "")
	//assert.Equal(t, 2, len(stateChange1), "state change not right")
	//
	//assert.True(t, new(uint256.Int).SetBytes(stateChange1[0].Value).Eq(uint256.NewInt(0)), "state 0 data not eq")
	//assert.True(t, new(uint256.Int).SetBytes(stateChange1[1].Value).Eq(uint256.NewInt(100)), "state 1 data not eq")
	//
	//assert.True(t, bytes.Compare(stateChange1[0].Account.Bytes(), common.Address{}.Bytes()) == 0, "state 0 account not eq")
	//assert.True(t, bytes.Compare(stateChange1[1].Account.Bytes(), sender.Bytes()) == 0, "state 1 account not eq")
	//
	//stateChange2 := stateChanges.Variable(address, "DummyDummy.dummy", "")
	//assert.Equal(t, 2, len(stateChange2), "state change not right")
	//
	//assert.Equal(t, "", string(stateChange2[0].Value))
	//assert.Equal(t, "haha", string(stateChange2[1].Value))
	//
	//assert.True(t, bytes.Compare(stateChange2[0].Account.Bytes(), common.Address{}.Bytes()) == 0, "state 0 account not eq")
	//assert.True(t, bytes.Compare(stateChange2[1].Account.Bytes(), sender.Bytes()) == 0, "state 1 account not eq")
}
